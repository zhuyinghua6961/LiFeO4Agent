# æ•°æ®åº“çŠ¶æ€æŠ¥å‘Š

ç”Ÿæˆæ—¶é—´: 2026-01-31

## æ•°æ®åº“é…ç½®

- **Host**: localhost (127.0.0.1)
- **Port**: 3306
- **Database**: material_kb
- **User**: root
- **Password**: bjut710 âœ…

## è¡¨ç»“æ„

### 1. users è¡¨

**ç”¨é€”**: å­˜å‚¨ç”¨æˆ·è´¦å·ä¿¡æ¯

**å­—æ®µåˆ—è¡¨**:
| å­—æ®µå | ç±»å‹ | è¯´æ˜ | çŠ¶æ€ |
|--------|------|------|------|
| id | int | ä¸»é”®ï¼Œè‡ªå¢ | âœ… |
| username | varchar(50) | ç”¨æˆ·åï¼Œå”¯ä¸€ | âœ… |
| password | varchar(255) | åŠ å¯†å¯†ç ï¼ˆAESï¼‰ | âœ… |
| role | enum('user','admin') | ç”¨æˆ·è§’è‰² | âœ… |
| status | enum('active','disabled') | è´¦å·çŠ¶æ€ | âœ… |
| created_at | timestamp | åˆ›å»ºæ—¶é—´ | âœ… |
| updated_at | timestamp | æ›´æ–°æ—¶é—´ | âœ… |
| password_updated_at | timestamp | å¯†ç æ›´æ–°æ—¶é—´ | âœ… æ–°å¢ |
| security_questions | json | å®‰å…¨é—®é¢˜ | âœ… æ–°å¢ |

**å½“å‰æ•°æ®**:
- æ€»ç”¨æˆ·æ•°: 2
- ç”¨æˆ·åˆ—è¡¨:
  1. admin (ç®¡ç†å‘˜) - åˆ›å»ºäº 2026-01-16
  2. testuser (æ™®é€šç”¨æˆ·) - åˆ›å»ºäº 2026-01-16

### 2. conversations è¡¨

**ç”¨é€”**: å­˜å‚¨ç”¨æˆ·å¯¹è¯è®°å½•

**å­—æ®µåˆ—è¡¨**:
| å­—æ®µå | ç±»å‹ | è¯´æ˜ | çŠ¶æ€ |
|--------|------|------|------|
| id | int | ä¸»é”®ï¼Œè‡ªå¢ | âœ… |
| user_id | int | ç”¨æˆ·IDï¼ˆå¤–é”®ï¼‰ | âœ… |
| title | varchar(255) | å¯¹è¯æ ‡é¢˜ | âœ… |
| file_path | varchar(500) | JSONæ–‡ä»¶è·¯å¾„ | âœ… |
| message_count | int | æ¶ˆæ¯æ•°é‡ | âœ… |
| created_at | timestamp | åˆ›å»ºæ—¶é—´ | âœ… |
| updated_at | timestamp | æ›´æ–°æ—¶é—´ | âœ… |

**å½“å‰æ•°æ®**:
- æ€»å¯¹è¯æ•°: 0
- æ— å¯¹è¯è®°å½•

## æ›´æ–°å†…å®¹

### âœ… å·²å®Œæˆçš„æ›´æ–°

1. **users è¡¨æ–°å¢å­—æ®µ**:
   - `password_updated_at`: ç”¨äºå¯†ç è¿‡æœŸæ£€æŸ¥ï¼ˆ180å¤©ï¼‰
   - `security_questions`: ç”¨äºå¿˜è®°å¯†ç åŠŸèƒ½

2. **æ•°æ®è¿ç§»**:
   - ä¸ºç°æœ‰ç”¨æˆ·è®¾ç½® `password_updated_at` = `created_at`

## åŠŸèƒ½æ”¯æŒ

### âœ… å·²æ”¯æŒçš„åŠŸèƒ½

1. **ç”¨æˆ·è®¤è¯**:
   - âœ… ç”¨æˆ·ç™»å½•
   - âœ… ç”¨æˆ·æ³¨å†Œ
   - âœ… TokenéªŒè¯
   - âœ… å¯†ç åŠ å¯†ï¼ˆAESåŒå‘åŠ å¯†ï¼‰

2. **å¯†ç ç®¡ç†**:
   - âœ… ä¿®æ”¹å¯†ç ï¼ˆéœ€è¦æ—§å¯†ç ï¼‰
   - âœ… å¯†ç è¿‡æœŸæ£€æŸ¥ï¼ˆ180å¤©ï¼‰
   - âœ… å¯†ç å¤æ‚åº¦éªŒè¯ï¼ˆå­—æ¯+æ•°å­—+ç¬¦å·ï¼Œè‡³å°‘8ä½ï¼‰

3. **å¿˜è®°å¯†ç **:
   - âœ… è®¾ç½®å®‰å…¨é—®é¢˜
   - âœ… é€šè¿‡å®‰å…¨é—®é¢˜é‡ç½®å¯†ç 

4. **å¯¹è¯ç®¡ç†**:
   - âœ… åˆ›å»ºå¯¹è¯
   - âœ… è·å–å¯¹è¯åˆ—è¡¨
   - âœ… æ›´æ–°å¯¹è¯æ ‡é¢˜
   - âœ… åˆ é™¤å¯¹è¯
   - âœ… å¯¹è¯æƒé™éªŒè¯

## æ•°æ®åº“è¿æ¥æµ‹è¯•

```bash
# æµ‹è¯•è¿æ¥
mysql -h 127.0.0.1 -u root -pbjut710 material_kb -e "SELECT VERSION();"

# æŸ¥çœ‹è¡¨
mysql -h 127.0.0.1 -u root -pbjut710 material_kb -e "SHOW TABLES;"

# æŸ¥çœ‹ç”¨æˆ·
mysql -h 127.0.0.1 -u root -pbjut710 material_kb -e "SELECT id, username, role, status FROM users;"
```

## å»ºè®®

### 1. æ•°æ®å¤‡ä»½
å»ºè®®å®šæœŸå¤‡ä»½æ•°æ®åº“ï¼š
```bash
mysqldump -h 127.0.0.1 -u root -pbjut710 material_kb > backup_$(date +%Y%m%d).sql
```

### 2. ç´¢å¼•ä¼˜åŒ–
å½“å‰ç´¢å¼•ï¼š
- users.username (UNIQUE)
- users.status (INDEX)
- conversations.user_id (INDEX)
- conversations.updated_at (INDEX)

å»ºè®®æ·»åŠ ï¼š
- conversations.created_at (INDEX) - å¦‚æœéœ€è¦æŒ‰åˆ›å»ºæ—¶é—´æ’åº

### 3. å®‰å…¨å»ºè®®
- âœ… å¯†ç å·²ä½¿ç”¨AESåŠ å¯†
- âœ… æ”¯æŒå¯†ç è¿‡æœŸæ£€æŸ¥
- âš ï¸ å»ºè®®å¯ç”¨SSLè¿æ¥
- âš ï¸ å»ºè®®é™åˆ¶rootç”¨æˆ·è¿œç¨‹è®¿é—®

## ä¸‹ä¸€æ­¥

1. âœ… æ•°æ®åº“è¡¨ç»“æ„å·²æ›´æ–°å®Œæˆ
2. âœ… æ”¯æŒæ‰€æœ‰åç«¯åŠŸèƒ½
3. ğŸ”„ å¯ä»¥å¼€å§‹æµ‹è¯•å‰åç«¯é›†æˆ
4. ğŸ”„ å»ºè®®æ·»åŠ æ›´å¤šæµ‹è¯•æ•°æ®

---

**æ›´æ–°è„šæœ¬**: `backend/scripts/update_database_schema.sql`  
**æŸ¥è¯¢è„šæœ¬**: `backend/scripts/query_database.py`
